<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MarkDown 文档整理工具</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
</head>
<body>
    <div class="container">
        <!-- 头部标题 -->
        <header class="header">
            <h1>📝 MarkDown 文档整理工具</h1>
            <p>格式修复 · 标点规范 · 繁简转换</p>
        </header>

        <!-- 主要内容区域 -->
        <main class="main-content">
            <!-- 左侧控制面板 -->
            <aside class="control-panel">
                <!-- 文件上传区域 -->
                <div class="upload-section">
                    <h3>📁 文件选择</h3>
                    <div class="upload-area" id="uploadArea">
                        <input type="file" id="fileInput" accept=".md,.markdown,.txt" hidden>
                        <div class="upload-placeholder">
                            <div class="upload-icon">📄</div>
                            <p>拖拽文件到此处<br>或点击选择文件</p>
                            <small>支持 .md, .markdown, .txt 格式</small>
                        </div>
                    </div>
                    <div class="file-info" id="fileInfo" style="display: none;">
                        <span class="file-name" id="fileName"></span>
                        <button class="btn-clear" id="clearFile">✕</button>
                    </div>
                </div>

                <!-- 操作按钮（上移：先检查再修复导出） -->
                <div class="actions-section">
                    <button class="btn-secondary" id="analyzeBtn" disabled>
                        🔎 检查与建议
                    </button>
                    <button class="btn-primary" id="processBtn" disabled>
                        ⚡ 一键修复
                    </button>
                    <button class="btn-download" id="exportBtn" disabled>
                        💾 导出文件
                    </button>
                </div>

                <!-- 修复选项 -->
                <div class="options-section">
                    <h3>🔧 修复选项</h3>
                    <div class="option-group">
                        <label class="option-item">
                            <input type="checkbox" id="fixFormat" checked>
                            <span class="checkmark"></span>
                            <div class="option-content">
                                <strong>格式修复</strong>
                                <small>标题层级、列表缩进、代码块格式</small>
                            </div>
                        </label>
                        
                        <label class="option-item">
                            <input type="checkbox" id="fixPunctuation" checked>
                            <span class="checkmark"></span>
                            <div class="option-content">
                                <strong>标点规范</strong>
                                <small>中英文标点符号规范化</small>
                            </div>
                        </label>
                        
                        <label class="option-item">
                            <input type="checkbox" id="convertTraditional" checked>
                            <span class="checkmark"></span>
                            <div class="option-content">
                                <strong>繁简转换</strong>
                                <small>繁体中文转换为简体中文</small>
                            </div>
                        </label>
                       
                        <label class="option-item">
                            <input type="checkbox" id="mergeBrokenLines">
                            <span class="checkmark"></span>
                            <div class="option-content">
                                <strong>合并断行</strong>
                                <small>合并段落中的断行</small>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 处理状态 -->
                <div class="status-section" id="statusSection" style="display: none;">
                    <div class="status-item">
                        <span class="status-label">处理状态:</span>
                        <span class="status-value" id="statusText">准备就绪</span>
                    </div>
                </div>
            </aside>

            <!-- 右侧编辑预览区域 -->
            <section class="editor-section">
                <div class="editor-header">
                    <div class="tab-buttons">
                        <button class="tab-btn active" id="editTab">📝 编辑器</button>
                        <button class="tab-btn" id="previewTab">👁️ 预览</button>
                        <button class="tab-btn" id="compareTab" style="display: none;">⚖️ 对比</button>
                    </div>
                </div>

                <!-- 编辑器容器 -->
                <div class="editor-container">
                    <!-- 源码编辑器 -->
                    <div class="editor-pane active" id="editorPane">
                        <div class="editor-toolbar">
                            <span class="toolbar-title">源码编辑 (支持手动微调)</span>
                            <button class="btn-reset" id="resetBtn" title="重置到原始内容">↺ 重置</button>
                        </div>
                        <textarea id="markdownEditor" placeholder="选择 Markdown 文件开始编辑..."></textarea>
                    </div>

                    <!-- 预览区域 -->
                    <div class="preview-pane" id="previewPane">
                        <div class="preview-toolbar">
                            <span class="toolbar-title">Markdown 预览</span>
                        </div>
                        <div class="preview-content" id="previewContent">
                            <div class="preview-placeholder">
                                <div class="preview-icon">👁️</div>
                                <p>实时预览 Markdown 渲染效果</p>
                            </div>
                        </div>
                    </div>

                    <!-- 对比视图 -->
                    <div class="compare-pane" id="comparePane">
                        <div class="compare-header">
                            <div class="compare-title">
                                <span class="compare-label original">📄 修复前</span>
                                <span class="compare-label processed">✨ 修复后</span>
                            </div>
                        </div>
                        <div class="compare-content">
                            <div class="compare-side original">
                                <pre id="originalContent"></pre>
                            </div>
                            <div class="compare-side processed">
                                <pre id="processedContent"></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <div class="issues-backdrop" id="issuesBackdrop" style="display:none;"></div>
        <div class="issues-panel" id="issuesPanel" style="display:none;">
            <div class="issues-header">
                <h3>检查结果</h3>
                <button class="btn-close-panel" id="closeIssuesPanel">×</button>
            </div>
            <div class="issues-list" id="issuesList"></div>
        </div>

        <!-- 导出弹窗 -->
        <div class="modal-backdrop" id="exportBackdrop" style="display:none;"></div>
        <div class="modal-panel" id="exportModal" style="display:none;">
            <div class="issues-header">
                <h3>导出文件</h3>
                <button class="btn-close-panel" id="closeExportModal">×</button>
            </div>
            <div class="issues-list">
                <div class="issues-summary">
                    <div class="summary-line">文件名：</div>
                    <input id="exportFileName" type="text" style="width:100%;padding:8px;border:1px solid #dee2e6;border-radius:6px;" />
                    <div class="summary-line">方式：</div>
                    <label style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
                        <input type="radio" name="exportMode" value="picker" checked> 使用系统保存对话框（浏览器支持）
                    </label>
                    <label style="display:flex;align-items:center;gap:8px;">
                        <input type="radio" name="exportMode" value="download"> 直接下载（浏览器下载栏）
                    </label>
                </div>
                <div class="issues-actions">
                    <button class="btn-secondary" id="confirmExport">确定导出</button>
                    <button class="btn-secondary" id="cancelExport">取消</button>
                </div>
            </div>
        </div>

        <div class="modal-backdrop" id="planBackdrop" style="display:none;"></div>
        <div class="modal-panel" id="planModal" style="display:none;">
            <div class="issues-header">
                <h3>修复计划</h3>
                <button class="btn-close-panel" id="closePlanModal">×</button>
            </div>
            <div class="issues-list" id="planContent"></div>
            <div class="issues-actions" style="padding: 15px;">
                <button class="btn-secondary" id="btnApplySafePlan">仅应用 SAFE 到该板块</button>
                <button class="btn-secondary" id="btnApplySuggestedPlan">应用 SUGGESTED 到该板块</button>
                <button class="btn-secondary" id="btnExportPlanJson">导出计划 JSON</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/lib/marked/marked.min.js"></script>
    <script src="js/linter.js"></script>
    <script src="js/app.js"></script>
</body>
</html>