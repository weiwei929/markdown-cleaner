# MarkDown 文档整理工具优化技术方案

## 1. 项目背景与目标
本项目旨在解决 Markdown 文档整理过程中的四大痛点：
1.  **格式混乱**：首行缩进不统一、行距异常、断行错误。
2.  **繁简转换**：需规范化繁体转简体。
3.  **标点/字符混乱**：全角半角混用、标点缺失或误用。
4.  **内容不规范**：错别字、语义错误。

## 2. 技术架构升级

### 2.1 核心编辑器升级 (已完成)
*   **方案**：从 `<textarea>` 迁移至 **CodeMirror**。
*   **收益**：支持语法高亮、行号、API 操作（文本标记、光标控制）、插件扩展（搜索替换）。

### 2.2 新增模块：手动检查 (Linter)
*   **设计理念**：从“自动暴力修改”转向“**辅助检查 + 用户确认**”。
*   **实现方式**：
    *   **前端规则引擎**：在浏览器端运行一组检测规则。
    *   **可视化交互**：使用 CodeMirror 的 `markText` API 在编辑器中对问题文本添加下划线/波浪线。
    *   **交互式修复**：点击问题处弹出修复建议气泡，或在侧边栏显示问题列表。

### 2.3 新增模块：查找与替换
*   **方案**：集成 CodeMirror 的 `search` 和 `jump-to-line` 插件。
*   **功能**：支持正则表达式搜索、批量替换，解决特定词汇（如繁简转换后的异体字）修正问题。

### 2.4 新增模块：AI 辅助 (规划中)
*   **方案**：后端集成 LLM (GPT/Gemini) API。
*   **功能**：
    *   **智能纠错**：识别错别字和语义不通顺。
    *   **格式重排**：智能合并断行、优化段落结构。

## 3. 详细实施计划

### 第一阶段：基础重构 (已完成)
- [x] 引入 CodeMirror 资源。
- [x] 重写 `app.js` 初始化编辑器实例。
- [x] 移除旧版“标点暴力修改”逻辑。
- [x] 优化 UI 样式适配新编辑器。

### 第二阶段：手动检查模块 (进行中)
- [ ] **创建规则引擎 (`linter.js`)**：
    -   `checkIndent`: 检测段首是否包含 2 个全角空格（Markdown 标准建议不缩进）。
    -   `checkHeader`: 检测标题 `#` 后是否缺失空格。
    -   `checkPunctuation`: 检测中文语境下的英文标点（如中文句子中的 `,` `.`）。
    -   `checkSpacing`: 检测中英文之间是否缺失空格。
- [ ] **UI 集成**：
    -   增加“🔍 检查文档”按钮。
    -   实现问题高亮样式（波浪线）。
    -   实现点击高亮处弹出“修复/忽略”菜单。

### 第三阶段：高级功能
- [ ] 集成查找替换功能栏。
- [ ] 优化繁简转换逻辑（保留专有名词例外）。

### 第四阶段：AI 集成
- [ ] 后端 `/api/ai-fix` 接口开发。
- [ ] 前端 AI 交互界面（选中润色、全文建议）。

## 4. 规则定义 (Linter Rules)

| 规则ID | 描述 | 检测逻辑 | 修复建议 |
| :--- | :--- | :--- | :--- |
| `indent-style` | 段首不应缩进 | 正则 `^(\u3000|\s){2,}` | 删除缩进 |
| `header-space` | 标题需空格 | 正则 `^#{1,6}[^ ]` | 插入空格 |
| `mixed-punc` | 中文误用英文标点 | 正则 `[\u4e00-\u9fff][,.:;?!]` | 转换为全角标点 |
| `missing-space`| 中英文间距 | 正则 `[\u4e00-\u9fff][a-zA-Z]` | 插入空格 |

---
*文档维护者: Antigravity*
*最后更新: 2025-11-21*
