# 文档检查器增强计划

## 一、工作流程重新设计

### 当前流程：
```
上传文件 → 选择选项 → 一键修复 → 查看结果
```

### 新流程：
```
上传文件 → 自动检查 → 展示问题 → 分类修复 → 查看结果
         ↓
    检查报告面板
    ├─ 安全修复（绿色）- 可自动执行
    ├─ 建议修复（黄色）- 需要确认
    └─ 警告修复（红色）- 高风险提示
```

## 二、修复优先级分级

### Level 1: 安全修复（Safe Fix）✅
**特征**：不改变文字内容，只调整格式
**可自动执行**：是
**包含规则**：
- `missing-space` - 中英文间距
- `header-space` - 标题空格
- `mixed-punc` - 标点符号规范
- `indent-style` - 段首缩进

**UI 显示**：
- 图标：✅ 
- 颜色：绿色
- 按钮：「自动修复全部」

### Level 2: 建议修复（Suggested Fix）⚠️
**特征**：可能改变文字排版，但不改变内容
**可自动执行**：需用户确认
**包含规则**：
- `broken-line` - 断行合并

**UI 显示**：
- 图标：⚠️
- 颜色：橙色
- 按钮：「批量修复」（需确认）

### Level 3: 警告修复（Warning Fix）❌
**特征**：可能改变文字内容或含义
**可自动执行**：否，需逐个确认
**包含规则**：
- 未来可能添加的内容修改规则

**UI 显示**：
- 图标：❌
- 颜色：红色
- 按钮：「逐个修复」

## 三、UI/UX 改进

### 1. 检查报告面板
```
┌─────────────────────────────────────┐
│ 📊 文档检查报告                      │
├─────────────────────────────────────┤
│ 文件：test.md                        │
│ 总问题：15 个                        │
│                                      │
│ ✅ 安全修复 (10)  [自动修复全部]     │
│ ⚠️ 建议修复 (5)   [批量修复]        │
│ ❌ 警告修复 (0)   [逐个修复]        │
│                                      │
│ [展开详情] [开始修复]                │
└─────────────────────────────────────┘
```

### 2. 问题列表分组显示
```
✅ 安全修复 (可自动执行)
  ├─ 第 3 行：标题 # 后缺少空格 [修复]
  ├─ 第 5 行：中英文之间建议添加空格 [修复]
  └─ 第 8 行：中文后使用了英文标点 [修复]

⚠️ 建议修复 (需要确认)
  ├─ 第 10-11 行：检测到段落断行 [预览] [修复]
  └─ 第 15-16 行：检测到段落断行 [预览] [修复]
```

### 3. 批量修复对话框
```
┌─────────────────────────────────────┐
│ 批量修复确认                         │
├─────────────────────────────────────┤
│ 即将修复 5 个断行问题                │
│                                      │
│ 预览修改：                           │
│ ┌─────────────────────────────────┐ │
│ │ 修复前：                         │ │
│ │ This is a paragraph             │ │
│ │ that has broken lines           │ │
│ │                                 │ │
│ │ 修复后：                         │ │
│ │ This is a paragraph that has... │ │
│ └─────────────────────────────────┘ │
│                                      │
│ [取消] [确认修复]                    │
└─────────────────────────────────────┘
```

## 四、技术实现要点

### 1. 修复优先级定义
```javascript
const FIX_PRIORITY = {
    SAFE: {
        level: 1,
        name: '安全修复',
        icon: '✅',
        color: '#2ecc71',
        autoFix: true,
        codes: ['missing-space', 'header-space', 'mixed-punc', 'indent-style']
    },
    SUGGESTED: {
        level: 2,
        name: '建议修复',
        icon: '⚠️',
        color: '#f39c12',
        autoFix: false,
        codes: ['broken-line']
    },
    WARNING: {
        level: 3,
        name: '警告修复',
        icon: '❌',
        color: '#e74c3c',
        autoFix: false,
        codes: []
    }
};
```

### 2. 自动检查触发
```javascript
async handleFileSelect(file) {
    // ... 读取文件
    
    // 自动触发检查
    this.runLinter();
    
    // 显示检查报告面板
    this.showCheckReport();
}
```

### 3. 批量修复方法
```javascript
async batchFix(issues, priority) {
    if (priority === 'SAFE') {
        // 安全修复：直接应用
        issues.forEach(issue => this.applyFix(issue));
    } else if (priority === 'SUGGESTED') {
        // 建议修复：显示确认对话框
        const confirmed = await this.showBatchFixDialog(issues);
        if (confirmed) {
            issues.forEach(issue => this.applyFix(issue));
        }
    } else {
        // 警告修复：逐个确认
        for (const issue of issues) {
            const confirmed = await this.showFixDialog(issue);
            if (confirmed) {
                this.applyFix(issue);
            }
        }
    }
}
```

## 五、实施步骤

### Phase 1: 核心功能（优先）
1. ✅ 添加修复优先级定义
2. ✅ 修改 linter 规则，添加优先级属性
3. ✅ 实现自动检查触发
4. ✅ 实现批量修复方法

### Phase 2: UI 改进
1. ✅ 设计检查报告面板
2. ✅ 实现问题分组显示
3. ✅ 添加批量修复按钮

### Phase 3: 用户体验优化
1. ✅ 添加修复预览功能
2. ✅ 添加批量修复确认对话框
3. ✅ 优化动画和交互

## 六、预期效果

### 用户体验提升：
- 📈 减少用户操作步骤：从 4 步减少到 2 步
- 🎯 提高修复准确性：分级处理，降低误操作
- ⚡ 提升修复效率：批量处理，节省时间
- 🛡️ 增强安全性：高风险操作需确认

### 产品价值提升：
- 🏆 更专业的工具定位
- 💎 更智能的修复建议
- 🎨 更友好的用户界面
- 📊 更清晰的问题展示

## 七、后续扩展

### 可能的新功能：
1. 修复历史记录
2. 自定义修复规则
3. 修复统计报告
4. 导出检查报告
5. 修复建议学习（AI）

---

**结论**：这个增强方案将使文档检查器成为工具的核心功能，大大提升用户体验和产品价值！
